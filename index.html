const GYM_CIRCUITS = [
            {
                name: "Upper Body Power & Paddle Strength",
                warmup: "5 min: Arm circles, band pull-aparts, thoracic rotations, shoulder dislocations",
                exercises: [
                    { name: "Dumbbell Bench Press", reps: "10-12", notes: "Explosive up, controlled down" },
                    { name: "Cable Rows", reps: "12", notes: "Simulate paddle motion, squeeze shoulder blades" },
                    { name: "Arnold Press", reps: "10", notes: "Full rotation for shoulder mobility" }
                ],
                rounds: "4-5",
                rest: "90 seconds",
                surfAddon: "Pop-up Burpees x10 (explosive chest-to-ground, jump to feet)"
            },
            {
                name: "Explosive Upper + Rotational Core",
                warmup: "5 min: Dynamic stretches, band rotations, cat-cow stretches",
                exercises: [
                    { name: "Explosive Push-ups", reps: "12", notes: "Clap or hands off ground" },
                    { name: "Landmine Rotations", reps: "10 each side", notes: "Full hip rotation for surf turns" },
                    { name: "Pull-ups or Lat Pulldowns", reps: "8-10", notes: "Wide grip for paddle strength" }
                ],
                rounds: "4-5",
                rest: "90 seconds",
                surfAddon: "TRX/Band Face Pulls x15 (paddle endurance)"
            },
            {
                name: "Lower Body Power & Pop-up Explosion",
                warmup: "5 min: Leg swings, hip circles, ankle mobility, band walks",
                exercises: [
                    { name: "Barbell or Goblet Squats", reps: "10-12", notes: "Explosive up for pop-up power" },
                    { name: "Single-Leg RDL", reps: "10 each leg", notes: "Balance and hamstring strength" },
                    { name: "Jump Lunges", reps: "8 each leg", notes: "Explosive switching for agility" }
                ],
                rounds: "4-5",
                rest: "90 seconds",
                surfAddon: "Box Jumps x10 (explosive pop-up simulation)"
            },
            {
                name: "Full Body Functional & Core Stability",
                warmup: "5 min: Inchworms, world's greatest stretch, plank to down dog",
                exercises: [
                    { name: "Deadlifts", reps: "8-10", notes: "Build posterior chain for stability" },
                    { name: "Dumbbell Thrusters", reps: "12", notes: "Full body power" },
                    { name: "Pallof Press", reps: "12 each side", notes: "Anti-rotation core for wave stability" }
                ],
                rounds: "4-5",
                rest: "90 seconds",
                surfAddon: "Bosu Ball or Balance Board holds x60 sec (surf balance)"
            },
            {
                name: "Shoulder Health & Paddle Endurance",
                warmup: "5 min: Band internal/external rotations, shoulder CARs, scapular slides",
                exercises: [
                    { name: "Face Pulls", reps: "15", notes: "Rear delt and rotator cuff health" },
                    { name: "Dumbbell Rows", reps: "12 each arm", notes: "Paddle power unilateral" },
                    { name: "Overhead Carries", reps: "30 sec each arm", notes: "Shoulder stability overhead" }
                ],
                rounds: "4",
                rest: "75 seconds",
                surfAddon: "Band Paddle Simulation x20 each arm (endurance)"
            },
            {
                name: "Core Power & Rotational Strength",
                warmup: "5 min: Bird dogs, dead bugs, spinal rotations",
                exercises: [
                    { name: "Ab Wheel Rollouts", reps: "10-12", notes: "Full extension for core strength" },
                    { name: "Russian Twists", reps: "20 total", notes: "Weighted for rotational power" },
                    { name: "Hanging Leg Raises", reps: "10-12", notes: "Straight legs for max engagement" }
                ],
                rounds: "4-5",
                rest: "60 seconds",
                surfAddon: "Medicine Ball Slams x15 (explosive core)"
            }
        ];

        const CARDIO_WORKOUTS = [
            {
                name: "Steady Endurance Run",
                description: "Build aerobic base and mental toughness",
                duration: "35-45 min",
                structure: "Conversational pace, nose breathing if possible",
                warmup: "5 min walk + dynamic leg swings",
                cooldown: "5 min walk + static stretches",
                surfAddon: "Finish with 10 pop-up burpees for surf conditioning"
            },
            {
                name: "Interval Power Run",
                description: "Explosive speed and paddle burst power",
                duration: "30 min total",
                structure: "5 min warm-up jog, then 8 rounds: 2 min hard / 1 min easy, 5 min cool down",
                warmup: "Dynamic warm-up + high knees",
                cooldown: "Walk + hip flexor stretches",
                surfAddon: "Sprint starts x5 (simulate catching wave)"
            },
            {
                name: "Hill Sprints for Leg Power",
                description: "Build explosive lower body for pop-ups",
                duration: "25 min total",
                structure: "Find a hill, sprint up 20-30 sec, walk down recovery, repeat 8-10 times",
                warmup: "10 min easy jog + leg swings",
                cooldown: "Stretching focus on calves and quads",
                surfAddon: "Downhill bounds x5 (controlled explosive)"
            }
        ];

        const BIKE_WORKOUTS = [
            {
                name: "Mountain Bike Endurance",
                description: "Leg endurance and mental toughness",
                duration: "60-90 min",
                structure: "Moderate pace with natural terrain variation",
                warmup: "10 min easy spin",
                cooldown: "10 min easy spin + quad stretches",
                surfAddon: "Finish with 20 jump squats (leg power)"
            },
            {
                name: "Bike Interval Power",
                description: "Explosive leg power for pop-ups",
                duration: "40 min total",
                structure: "10 min warm-up, then 6 rounds: 3 min hard / 2 min easy, 10 min cool down",
                warmup: "Easy spin + leg swings",
                cooldown: "Easy spin + stretching",
                surfAddon: "Box jumps x10 (explosive power transfer)"
            }
        ];

        const SWIM_WORKOUTS = [
            {
                name: "Endurance Swim",
                description: "Shoulder endurance and breathing",
                duration: "35-45 min",
                structure: "Continuous swimming, mix freestyle and backstroke for shoulder balance",
                warmup: "5 min easy swim + arm circles",
                cooldown: "5 min easy + shoulder stretches",
                surfAddon: "Sprint swim 25m x4 (paddle burst simulation)"
            },
            {
                name: "Surf Training Swim",
                description: "Paddle power and breath control",
                duration: "30 min",
                structure: "10 rounds: 50m sprint / 30 sec rest (simulate paddling out)",
                warmup: "200m easy mixed strokes",
                cooldown: "Easy 200m + static stretches",
                surfAddon: "Underwater swimming x3 lengths (breath work)"
            }
        ];

        const HOME_CIRCUITS = [
            {
                name: "Bodyweight Power Circuit",
                warmup: "5 min: Jumping jacks, arm circles, hip openers",
                exercises: [
                    { name: "Jump Squats", reps: "12", notes: "Explosive for pop-up power" },
                    { name: "Decline Push-ups", reps: "12", notes: "Feet elevated for paddle strength" },
                    { name: "Reverse Lunges", reps: "10 each leg", notes: "Balance and leg strength" }
                ],
                rounds: "4-5",
                rest: "75 seconds",
                surfAddon: "Pop-up practice x20 (dry land surf conditioning)"
            },
            {
                name: "Band & Core Strength",
                warmup: "5 min: Dynamic stretches with bands",
                exercises: [
                    { name: "Band Pull-aparts", reps: "15", notes: "Shoulder health and posture" },
                    { name: "Ab Wheel Rollouts", reps: "10-12", notes: "Core strength and control" },
                    { name: "Band Rows", reps: "15", notes: "Paddle simulation" }
                ],
                rounds: "4-5",
                rest: "60 seconds",
                surfAddon: "Band rotational chops x12 each side (surf turns)"
            },
            {
                name: "Jump Rope HIIT & Agility",
                warmup: "3 min: Light jump rope + ankle bounces",
                exercises: [
                    { name: "Jump Rope", reps: "60 seconds", notes: "Fast pace cardio" },
                    { name: "Burpees", reps: "10", notes: "Full body explosive" },
                    { name: "Mountain Climbers", reps: "30 seconds", notes: "Core and cardio" }
                ],
                rounds: "4-5",
                rest: "90 seconds",
                surfAddon: "Lateral bounds x20 total (agility)"
            }
        ];

        const generateWorkoutPlan = (availableDays, profile) => {
            const selectedDays = availableDays.filter(d => d.selected);
            
            if (selectedDays.length === 0) return [];

            const plan = [];
            const workoutTypes = ['gym', 'cardio', 'bike', 'swim', 'home'];
            let gymCount = 0;
            let typeIndex = 0;

            selectedDays.slice(0, 5).forEach((day, index) => {
                let type = workoutTypes[typeIndex % workoutTypes.length];
                let workout = {};

                if (type === 'gym') {
                    const circuit1 = GYM_CIRCUITS[gymCount % GYM_CIRCUITS.length];
                    const circuit2 = GYM_CIRCUITS[(gymCount + 1) % GYM_CIRCUITS.length];
                    
                    workout = {
                        day: day.day,
                        type: 'Gym',
                        options: [circuit1, circuit2],
                        hasOptions: true
                    };
                    gymCount += 2;
                } else if (type === 'cardio') {
                    const cardioWorkout = CARDIO_WORKOUTS[Math.floor(Math.random() * CARDIO_WORKOUTS.length)];
                    workout = {
                        day: day.day,
                        type: 'Cardio',
                        ...cardioWorkout,
                        hasOptions: false
                    };
                } else if (type === 'bike') {
                    const bikeWorkout = BIKE_WORKOUTS[Math.floor(Math.random() * BIKE_WORKOUTS.length)];
                    workout = {
                        day: day.day,
                        type: 'Bike',
                        ...bikeWorkout,
                        hasOptions: false
                    };
                } else if (type === 'swim') {
                    const swimWorkout = SWIM_WORKOUTS[Math.floor(Math.random() * SWIM_WORKOUTS.length)];
                    workout = {
                        day: day.day,
                        type: 'Swim',
                        ...swimWorkout,
                        hasOptions: false
                    };
                } else if (type === 'home') {
                    const homeCircuit1 = HOME_CIRCUITS[Math.floor(Math.random() * HOME_CIRCUITS.length)];
                    const homeCircuit2 = HOME_CIRCUITS[(HOME_CIRCUITS.indexOf(homeCircuit1) + 1) % HOME_CIRCUITS.length];
                    
                    workout = {
                        day: day.day,
                        type: 'Home',
                        options: [homeCircuit1, homeCircuit2],
                        hasOptions: true
                    };
                }

                if (profile?.injuries && profile.injuries.toLowerCase() !== 'none' && profile.injuries.trim() !== '') {
                    workout.injuryNote = `⚠️ Modified for: ${profile.injuries}`;
                }

                plan.push(workout);
                typeIndex++;
            });

            return plan;
        };

        const GetItDone = () => {
            const [currentView, setCurrentView] = useState('dashboard');
            const [profile, setProfile] = useState(null);
            const [workouts, setWorkouts] = useState([]);
            const [currentStreak, setCurrentStreak] = useState(0);
            const [weeklyPlan, setWeeklyPlan] = useState(null);
            const [db, setDb] = useState(null);
            const [expandedWorkout, setExpandedWorkout] = useState(null);
            const [videoModal, setVideoModal] = useState(null);
            const [logMode, setLogMode] = useState(null);
            const [scheduledWorkoutToLog, setScheduledWorkoutToLog] = useState(null);

            useEffect(() => {
                initDB().then(database => {
                    setDb(database);
                    loadProfile(database);
                    loadWorkouts(database);
                    loadWeeklyPlan(database);
                });
            }, []);

            const loadProfile = async (database) => {
                const tx = database.transaction('profile', 'readonly');
                const store = tx.objectStore('profile');
                const request = store.get('main');
                
                request.onsuccess = () => {
                    if (request.result) {
                        setProfile(request.result);
                    }
                };
            };

            const loadWorkouts = async (database) => {
                const tx = database.transaction('workouts', 'readonly');
                const store = tx.objectStore('workouts');
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const allWorkouts = request.result;
                    setWorkouts(allWorkouts);
                    calculateStreak(allWorkouts);
                };
            };

            const loadWeeklyPlan = async (database) => {
                const tx = database.transaction('weeklyPlans', 'readonly');
                const store = tx.objectStore('weeklyPlans');
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const plans = request.result;
                    if (plans.length > 0) {
                        const latestPlan = plans[plans.length - 1];
                        setWeeklyPlan(latestPlan);
                    }
                };
            };

            const saveWeeklyPlan = async (plan) => {
                if (!db) return;
                
                const planData = {
                    workouts: plan,
                    createdAt: new Date().toISOString(),
                    weekOf: new Date().toLocaleDateString()
                };
                
                const tx = db.transaction('weeklyPlans', 'readwrite');
                const store = tx.objectStore('weeklyPlans');
                store.add(planData);
                
                tx.oncomplete = () => {
                    setWeeklyPlan(planData);
                    setCurrentView('dashboard');
                };
            };

            const saveWorkout = async (workoutData) => {
                if (!db) return;
                
                const workout = {
                    ...workoutData,
                    date: new Date().toISOString()
                };
                
                const tx = db.transaction('workouts', 'readwrite');
                const store = tx.objectStore('workouts');
                store.add(workout);
                
                tx.oncomplete = () => {
                    loadWorkouts(db);
                    setCurrentView('dashboard');
                    setLogMode(null);
                    setScheduledWorkoutToLog(null);
                };
            };

            const calculateStreak = (allWorkouts) => {
                if (allWorkouts.length === 0) {
                    setCurrentStreak(0);
                    return;
                }

                const sortedWorkouts = allWorkouts.sort((a, b) => new Date(b.date) - new Date(a.date));
                let streak = 0;
                let currentDate = new Date();
                currentDate.setHours(0, 0, 0, 0);

                for (let workout of sortedWorkouts) {
                    const workoutDate = new Date(workout.date);
                    workoutDate.setHours(0, 0, 0, 0);
                    
                    const diffDays = Math.floor((currentDate - workoutDate) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === streak) {
                        streak++;
                    } else if (diffDays > streak) {
                        break;
                    }
                }
                
                setCurrentStreak(streak);
            };

            const saveProfile = async (profileData) => {
                if (!db) return;
                
                const tx = db.transaction('profile', 'readwrite');
                const store = tx.objectStore('profile');
                store.put({ id: 'main', ...profileData });
                
                tx.oncomplete = () => {
                    setProfile({ id: 'main', ...profileData });
                    setCurrentView('dashboard');
                };
            };

            const getTodayWorkout = () => {
                if (!weeklyPlan) return null;
                
                const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });
                return weeklyPlan.workouts?.find(w => w.day === today);
            };

            const hasCompletedToday = () => {
                const today = new Date().toDateString();
                return workouts.some(w => new Date(w.date).toDateString() === today);
            };

            const getYouTubeSearchUrl = (exerciseName) => {
                const searchQuery = encodeURIComponent(exerciseName + " proper form tutorial");
                return `https://www.youtube.com/results?search_query=${searchQuery}`;
            };

            const ExerciseVideoModal = ({ exercise, onClose }) => {
                if (!exercise) return null;
                
                return (
                    <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4" onClick={onClose}>
                        <div className="bg-gray-900 rounded-2xl max-w-md w-full" onClick={(e) => e.stopPropagation()}>
                            <div className="border-b border-gray-700 p-4 flex items-center justify-between">
                                <h3 className="text-white font-bold text-lg">{exercise.name}</h3>
                                <button
                                    onClick={onClose}
                                    className="text-gray-400 hover:text-white"
                                >
                                    <X size={24} />
                                </button>
                            </div>
                            
                            <div className="p-6 space-y-4">
                                <div className="bg-gray-800 rounded-lg p-4">
                                    <p className="text-blue-400 text-sm font-semibold mb-1">TARGET REPS:</p>
                                    <p className="text-white text-lg">{exercise.reps}</p>
                                </div>
                                
                                <div className="bg-gray-800 rounded-lg p-4">
                                    <p className="text-green-400 text-sm font-semibold mb-2">FORM NOTES:</p>
                                    <p className="text-gray-300 text-sm">{exercise.notes}</p>
                                </div>

                                
                                    href={getYouTubeSearchUrl(exercise.name)}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl transition flex items-center justify-center gap-2"
                                >
                                    <PlayCircle size={24} />
                                    Watch Tutorial on YouTube
                                </a>

                                <p className="text-gray-500 text-xs text-center">
                                    Opens YouTube in a new tab with tutorial videos
                                </p>
                            </div>
                        </div>
                    </div>
                );
            };
const WorkoutCard = ({ workout, isExpanded, onToggle }) => {
                if (workout.hasOptions) {
                    return (
                        <div className="bg-gray-800 rounded-xl overflow-hidden">
                            <button
                                onClick={onToggle}
                                className="w-full p-4 text-left flex items-center justify-between"
                            >
                                <div className="flex-1">
                                    <p className="text-white font-bold text-lg">{workout.day}</p>
                                    <p className="text-blue-400 font-semibold">{workout.type} Day - 2 Circuit Options</p>
                                    <p className="text-gray-400 text-xs mt-1">Tap to view circuits</p>
                                </div>
                                <ChevronDown 
                                    size={24} 
                                    className={`text-gray-400 transition-transform ${isExpanded ? 'rotate-180' : ''}`}
                                />
                            </button>
                            
                            {isExpanded && (
                                <div className="px-4 pb-4 space-y-4">
                                    {workout.injuryNote && (
                                        <p className="text-yellow-400 text-xs bg-yellow-900/20 p-2 rounded">
                                            {workout.injuryNote}
                                        </p>
                                    )}
                                    
                                    {workout.options.map((option, idx) => (
                                        <div key={idx} className="bg-gray-700 rounded-lg p-4">
                                            <p className="text-white font-bold mb-2">Option {idx + 1}: {option.name}</p>
                                            
                                            <div className="mb-3">
                                                <p className="text-blue-300 text-xs font-semibold mb-1">WARM-UP:</p>
                                                <p className="text-gray-300 text-xs">{option.warmup}</p>
                                            </div>
                                            
                                            <div className="mb-3">
                                                <p className="text-green-300 text-xs font-semibold mb-2">CIRCUIT ({option.rounds} rounds):</p>
                                                {option.exercises.map((ex, i) => (
                                                    <div key={i} className="mb-2 pl-3 border-l-2 border-green-500">
                                                        <button
                                                            onClick={() => setVideoModal(ex)}
                                                            className="text-left w-full hover:bg-gray-600/30 rounded p-2 transition"
                                                        >
                                                            <div className="flex items-center gap-2">
                                                                <PlayCircle size={16} className="text-red-500 flex-shrink-0" />
                                                                <div className="flex-1">
                                                                    <p className="text-white text-sm font-semibold">{i + 1}. {ex.name}</p>
                                                                    <p className="text-gray-400 text-xs">{ex.reps} reps</p>
                                                                    <p className="text-gray-500 text-xs italic">{ex.notes}</p>
                                                                </div>
                                                            </div>
                                                        </button>
                                                    </div>
                                                ))}
                                                <p className="text-orange-300 text-xs mt-2">💪 Rest: {option.rest} between rounds</p>
                                            </div>
                                            
                                            <div className="bg-purple-900/30 rounded p-2 mt-2">
                                                <p className="text-purple-300 text-xs font-semibold mb-1">🏄 SURF ADD-ON (Optional):</p>
                                                <p className="text-gray-300 text-xs">{option.surfAddon}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    );
                } else {
                    return (
                        <div className="bg-gray-800 rounded-xl overflow-hidden">
                            <button
                                onClick={onToggle}
                                className="w-full p-4 text-left flex items-center justify-between"
                            >
                                <div className="flex-1">
                                    <p className="text-white font-bold text-lg">{workout.day}</p>
                                    <p className="text-blue-400 font-semibold">{workout.name}</p>
                                    <p className="text-gray-400 text-xs mt-1">{workout.type} • {workout.duration}</p>
                                </div>
                                <ChevronDown 
                                    size={24} 
                                    className={`text-gray-400 transition-transform ${isExpanded ? 'rotate-180' : ''}`}
                                />
                            </button>
                            
                            {isExpanded && (
                                <div className="px-4 pb-4">
                                    {workout.injuryNote && (
                                        <p className="text-yellow-400 text-xs bg-yellow-900/20 p-2 rounded mb-3">
                                            {workout.injuryNote}
                                        </p>
                                    )}
                                    
                                    <p className="text-gray-300 text-sm mb-3">{workout.description}</p>
                                    
                                    <div className="mb-3">
                                        <p className="text-blue-300 text-xs font-semibold mb-1">WARM-UP:</p>
                                        <p className="text-gray-300 text-xs">{workout.warmup}</p>
                                    </div>
                                    
                                    <div className="mb-3">
                                        <p className="text-green-300 text-xs font-semibold mb-1">WORKOUT:</p>
                                        <p className="text-gray-300 text-xs">{workout.structure}</p>
                                    </div>
                                    
                                    <div className="mb-3">
                                        <p className="text-orange-300 text-xs font-semibold mb-1">COOL-DOWN:</p>
                                        <p className="text-gray-300 text-xs">{workout.cooldown}</p>
                                    </div>
                                    
                                    <div className="bg-purple-900/30 rounded p-2">
                                        <p className="text-purple-300 text-xs font-semibold mb-1">🏄 SURF ADD-ON (Optional):</p>
                                        <p className="text-gray-300 text-xs">{workout.surfAddon}</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    );
                }
            };

            const Dashboard = () => {
                const todayWorkout = getTodayWorkout();
                const completedToday = hasCompletedToday();
                
                return (
                    <div className="p-6 space-y-6">
                        <div className="text-center">
                            <h1 className="text-4xl font-bold text-white mb-2">GetItDone</h1>
                            <p className="text-gray-400">
                                {new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}
                            </p>
                        </div>

                        <div className="bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl p-6 shadow-xl">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-white/80 text-sm font-medium">Current Streak</p>
                                    <p className="text-5xl font-bold text-white mt-1">{currentStreak}</p>
                                    <p className="text-white/80 text-sm mt-1">days</p>
                                </div>
                                <Flame size={64} className="text-white/30" />
                            </div>
                        </div>

                        <div className="bg-gray-800 rounded-2xl p-6 shadow-xl">
                            <h2 className="text-xl font-bold text-white mb-4">Today's Workout</h2>
                            {todayWorkout ? (
                                <div className="space-y-3">
                                    <WorkoutCard 
                                        workout={todayWorkout}
                                        isExpanded={expandedWorkout === todayWorkout.day}
                                        onToggle={() => setExpandedWorkout(expandedWorkout === todayWorkout.day ? null : todayWorkout.day)}
                                    />
                                    {!completedToday && (
                                        <button
                                            onClick={() => {
                                                setScheduledWorkoutToLog(todayWorkout);
                                                setLogMode('scheduled');
                                                setCurrentView('logger');
                                            }}
                                            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition mt-3"
                                        >
                                            Start Workout
                                        </button>
                                    )}
                                    {completedToday && (
                                        <div className="flex items-center justify-center gap-2 text-green-500 font-semibold">
                                            <CheckCircle size={24} />
                                            <span>Completed!</span>
                                        </div>
                                    )}
                                </div>
                            ) : (
                                <div className="text-center py-8">
                                    <p className="text-gray-400 mb-4">No workout scheduled for today</p>
                                    <button
                                        onClick={() => setCurrentView('planner')}
                                        className="mt-4 text-blue-400 hover:text-blue-300 font-medium"
                                    >
                                        Plan Your Week →
                                    </button>
                                </div>
                            )}
                        </div>

                        {weeklyPlan && weeklyPlan.workouts && weeklyPlan.workouts.length > 0 && (
                            <div className="bg-gray-800 rounded-2xl p-6 shadow-xl">
                                <h2 className="text-xl font-bold text-white mb-4">This Week's Plan</h2>
                                <div className="space-y-3">
                                    {weeklyPlan.workouts.map((workout, idx) => (
                                        <WorkoutCard
                                            key={idx}
                                            workout={workout}
                                            isExpanded={expandedWorkout === workout.day}
                                            onToggle={() => setExpandedWorkout(expandedWorkout === workout.day ? null : workout.day)}
                                        />
                                    ))}
                                </div>
                                <button
                                    onClick={() => setCurrentView('planner')}
                                    className="w-full mt-4 text-blue-400 hover:text-blue-300 text-sm font-medium"
                                >
                                    Generate New Plan
                                </button>
                            </div>
                        )}

                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-gray-800 rounded-xl p-4">
                                <p className="text-gray-400 text-sm">This Week</p>
                                <p className="text-3xl font-bold text-white mt-1">
                                    {workouts.filter(w => {
                                        const weekAgo = new Date();
                                        weekAgo.setDate(weekAgo.getDate() - 7);
                                        return new Date(w.date) > weekAgo;
                                    }).length}
                                </p>
                                <p className="text-gray-400 text-xs mt-1">workouts</p>
                            </div>
                            <div className="bg-gray-800 rounded-xl p-4">
                                <p className="text-gray-400 text-sm">Total</p>
                                <p className="text-3xl font-bold text-white mt-1">{workouts.length}</p>
                                <p className="text-gray-400 text-xs mt-1">workouts</p>
                            </div>
                        </div>

                        {!profile && (
                            <div className="bg-blue-900/30 border border-blue-500/50 rounded-xl p-4">
                                <p className="text-blue-200 font-medium mb-2">Welcome! Set up your profile first</p>
                                <button
                                    onClick={() => setCurrentView('profile')}
                                    className="text-blue-400 hover:text-blue-300 font-medium text-sm"
                                >
                                    Complete Setup →
                                </button>
                            </div>
                        )}
                    </div>
                );
            };

            const ProfileSetup = () => {
                const [formData, setFormData] = useState({
                    goals: profile?.goals || '',
                    weight: profile?.weight || '',
                    injuries: profile?.injuries || '',
                    preferredWorkoutTime: profile?.preferredWorkoutTime || 'morning'
                });

                return (
                    <div className="p-6">
                        <h2 className="text-2xl font-bold text-white mb-6">Your Profile</h2>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-300 mb-2">
                                    Primary Goals
                                </label>
                                <textarea
                                    value={formData.goals}
                                    onChange={(e) => setFormData({...formData, goals: e.target.value})}
                                    className="w-full bg-gray-800 text-white rounded-xl p-3 border border-gray-700 focus:border-blue-500 focus:outline-none"
                                    rows="3"
                                    placeholder="Build muscle, improve mobility, surfing performance..."
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-300 mb-2">
                                    Current Weight (lbs)
                                </label>
                                <input
                                    type="number"
                                    value={formData.weight}
                                    onChange={(e) => setFormData({...formData, weight: e.target.value})}
                                    className="w-full bg-gray-800 text-white rounded-xl p-3 border border-gray-700 focus:border-blue-500 focus:outline-none"
                                    placeholder="185"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-300 mb-2">
                                    Current Injuries or Limitations
                                </label>
                                <textarea
                                    value={formData.injuries}
                                    onChange={(e) => setFormData({...formData, injuries: e.target.value})}
                                    className="w-full bg-gray-800 text-white rounded-xl p-3 border border-gray-700 focus:border-blue-500 focus:outline-none"
                                    rows="2"
                                    placeholder="None, or describe any injuries..."
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-300 mb-2">
                                    Preferred Workout Time
                                </label>
                                <select
                                    value={formData.preferredWorkoutTime}
                                    onChange={(e) => setFormData({...formData, preferredWorkoutTime: e.target.value})}
                                    className="w-full bg-gray-800 text-white rounded-xl p-3 border border-gray-700 focus:border-blue-500 focus:outline-none"
                                >
                                    <option value="morning">Morning</option>
                                    <option value="afternoon">Afternoon</option>
                                    <option value="evening">Evening</option>
                                </select>
                            </div>

                            <button
                                onClick={() => saveProfile(formData)}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition mt-6"
                            >
                                Save Profile
                            </button>
                        </div>
                    </div>
                );
            };

            const WeeklyPlanner = () => {
                const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                const [selectedDays, setSelectedDays] = useState(
                    daysOfWeek.map(day => ({ day, selected: false }))
                );
                const [generatedPlan, setGeneratedPlan] = useState(null);
                const [expandedPlanWorkout, setExpandedPlanWorkout] = useState(null);

                const toggleDay = (index) => {
                    const newDays = [...selectedDays];
                    newDays[index].selected = !newDays[index].selected;
                    setSelectedDays(newDays);
                };

                const handleGenerate = () => {
                    const plan = generateWorkoutPlan(selectedDays, profile);
                    setGeneratedPlan(plan);
                    setExpandedPlanWorkout(null);
                };

                const handleSavePlan = () => {
                    if (generatedPlan) {
                        saveWeeklyPlan(generatedPlan);
                        setExpandedPlanWorkout(null);
                    }
                };

                return (
                    <div className="p-6">
                        <h2 className="text-2xl font-bold text-white mb-2">Weekly Planner</h2>
                        <p className="text-gray-400 text-sm mb-6">Select 5 days you can train this week</p>
                        
                        {!generatedPlan ? (
                            <>
                                <div className="space-y-3 mb-6">
                                    {selectedDays.map((day, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => toggleDay(idx)}
                                            className={`w-full p-4 rounded-xl text-left font-semibold transition ${
                                                day.selected 
                                                    ? 'bg-blue-600 text-white' 
                                                    : 'bg-gray-800 text-gray-400 hover:bg-gray-700'
                                            }`}
                                        >
                                            <div className="flex items-center justify-between">
                                                <span>{day.day}</span>
                                                {day.selected && <CheckCircle size={20} />}
                                            </div>
                                        </button>
                                    ))}
                                </div>

                                <button
                                    onClick={handleGenerate}
                                    disabled={selectedDays.filter(d => d.selected).length === 0}
                                    className="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-4 rounded-xl transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                >
                                    <Sparkles size={20} />
                                    Generate My Workout Plan
                                </button>
                            </>
                        ) : (
                            <>
                                <div className="space-y-4 mb-6">
                                    {generatedPlan.map((workout, idx) => (
                                        <WorkoutCard
                                            key={idx}
                                            workout={workout}
                                            isExpanded={expandedPlanWorkout === workout.day}
                                            onToggle={() => setExpandedPlanWorkout(expandedPlanWorkout === workout.day ? null : workout.day)}
                                        />
                                    ))}
                                </div>

                                <div className="flex gap-3">
                                    <button
                                        onClick={() => {
                                            setGeneratedPlan(null);
                                            setExpandedPlanWorkout(null);
                                        }}
                                        className="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 rounded-xl transition"
                                    >
                                        Regenerate
                                    </button>
                                    <button
                                        onClick={handleSavePlan}
                                        className="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl transition"
                                    >
                                        Save Plan
                                    </button>
                                </div>
                            </>
                        )}
                    </div>
                );
            };

            const WorkoutLogger = () => {
                const [workoutType, setWorkoutType] = useState(scheduledWorkoutToLog?.type || 'Gym');
                const [exerciseLog, setExerciseLog] = useState([]);
                const [currentExercise, setCurrentExercise] = useState('');
                const [currentSets, setCurrentSets] = useState([]);
                const [duration, setDuration] = useState('');
                const [distance, setDistance] = useState('');
                const [pace, setPace] = useState('');
                const [feeling, setFeeling] = useState(0);
                const [notes, setNotes] = useState('');

                const addSet = () => {
                    setCurrentSets([...currentSets, { weight: '', reps: '' }]);
                };

                const updateSet = (index, field, value) => {
                    const newSets = [...currentSets];
                    newSets[index][field] = value;
                    setCurrentSets(newSets);
                };

                const removeSet = (index) => {
                    const newSets = currentSets.filter((_, i) => i !== index);
                    setCurrentSets(newSets);
                };

                const addExercise = () => {
                    if (currentExercise.trim() && currentSets.length > 0) {
                        setExerciseLog([...exerciseLog, {
                            name: currentExercise,
                            sets: currentSets
                        }]);
                        setCurrentExercise('');
                        setCurrentSets([]);
                    }
                };

                const removeExercise = (index) => {
                    setExerciseLog(exerciseLog.filter((_, i) => i !== index));
                };

                const handleSave = () => {
                    const workoutData = {
                        type: workoutType,
                        scheduledWorkout: scheduledWorkoutToLog?.name || null,
                        feeling,
                        notes
                    };

                    if (workoutType === 'Gym' || workoutType === 'Home') {
                        workoutData.exercises = exerciseLog;
                    } else {
                        workoutData.duration = duration;
                        workoutData.distance = distance;
                        workoutData.pace = pace;
                    }

                    saveWorkout(workoutData);
                };

                const isCardio = workoutType === 'Cardio' || workoutType === 'Bike' || workoutType === 'Swim';

                return (
                    <div className="p-6 pb-32">
                        <div className="flex items-center justify-between mb-6">
                            <div>
                                <h2 className="text-2xl font-bold text-white">Log Workout</h2>
                                {scheduledWorkoutToLog && (
                                    <p className="text-blue-400 text-sm mt-1">{scheduledWorkoutToLog.name}</p>
                                )}
                            </div>
                            <button
                                onClick={() => {
                                    setLogMode(null);
                                    setScheduledWorkoutToLog(null);
                                    setCurrentView('dashboard');
                                }}
                                className="text-gray-400 hover:text-white"
                            >
                                <X size={24} />
                            </button>
                        </div>

                        {!scheduledWorkoutToLog && (
                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-300 mb-2">
                                    Workout Type
                                </label>
                                <select
                                    value={workoutType}
                                    onChange={(e) => {
                                        setWorkoutType(e.target.value);
                                        setExerciseLog([]);
                                        setCurrentSets([]);
                                    }}
                                    className="w-full bg-gray-800 text-white rounded-xl p-3 border border-gray-700 focus:border-blue-500 focus:outline-none"
                                >
                                    <option value="Gym">Gym</option>
                                    <option value="Cardio">Cardio</option>
                                    <option value="Bike">Bike</option>
                                    <option value="Swim">Swim</option>
                                    <option value="Home">Home</option>
                                </select>
                            </div>
                        )}

                        {!isCardio && (
                            <div className="space-y-6">
                                {exerciseLog.length > 0 && (
                                    <div className="space-y-3">
                                        <h3 className="text-white font-semibold">Completed Exercises</h3>
                                        {exerciseLog.map((exercise, idx) => (
                                            <div key={idx} className="bg-gray-800 rounded-xl p-4">
                                                <div className="flex items-start justify-between mb-2">
                                                    <p className="text-white font-bold">{exercise.name}</p>
                                                    <button
                                                        onClick={() => removeExercise(idx)}
                                                        className="text-red-500 hover:text-red-400"
                                                    >
                                                        <Trash size={18} />
                                                    </button>
                                                </div>
                                                {exercise.sets.map((set, setIdx) => (
                                                    <p key={setIdx} className="text-gray-400 text-sm">
                                                        Set {setIdx + 1}: {set.weight}lbs × {set.reps} reps
                                                    </p>
                                                ))}
                                            </div>
                                        ))}
                                    </div>
                                )}

                                <div className="bg-gray-800 rounded-xl p-4 space-y-4">
                                    <h3 className="text-white font-semibold">Add Exercise</h3>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">
                                            Exercise Name
                                        </label>
                                        <input
                                            type="text"
                                            value={currentExercise}
                                            onChange={(e) => setCurrentExercise(e.target.value)}
                                            className="w-full bg-gray-700 text-white rounded-xl p-3 border border-gray-600 focus:border-blue-500 focus:outline-none"
                                            placeholder="Bench Press"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">
                                            Sets
                                        </label>
                                        {currentSets.map((set, idx) => (
                                            <div key={idx} className="flex gap-2 mb-2">
                                                <div className="flex-1">
                                                    <input
                                                        type="number"
                                                        value={set.weight}
                                                        onChange={(e) => updateSet(idx, 'weight', e.target.value)}
                                                        className="w-full bg-gray-700 text-white rounded-lg p-2 border border-gray-600 focus:border-blue-500 focus:outline-none"
                                                        placeholder="Weight (lbs)"
                                                    />
                                                </div>
                                                <div className="flex-1">
                                                    <input
                                                        type="number"
                                                        value={set.reps}
                                                        onChange={(e) => updateSet(idx, 'reps', e.target.value)}
                                                        className="w-full bg-gray-700 text-white rounded-lg p-2 border border-gray-600 focus:border-blue-500 focus:outline-none"
                                                        placeholder="Reps"
                                                    />
                                                </div>
                                                <button
                                                    onClick={() => removeSet(idx)}
                                                    className="text-red-500 hover:text-red-400 px-2"
                                                >
                                                    <Trash size={20} />
                                                </button>
                                            </div>
                                        ))}
                                        <button
                                            onClick={addSet}
                                            className="w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 rounded-lg transition"
                                        >
                                            + Add Set
                                        </button>
                                    </div>

                                    <button
                                        onClick={addExercise}
                                        disabled={!currentExercise.trim() || currentSets.length === 0}
                                        className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-bold py-3 rounded-xl transition"
                                    >
                                        Save Exercise
                                    </button>
                                </div>
                            </div>
                        )}

                        {isCardio && (
                            <div className="bg-gray-800 rounded-xl p-4 space-y-4">
                                <h3 className="text-white font-semibold">Workout Details</h3>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-300 mb-2">
                                        Duration (minutes)
                                    </label>
                                    <input
                                        type="number"
                                        value={duration}
                                        onChange={(e) => setDuration(e.target.value)}
                                        className="w-full bg-gray-700 text-white rounded-xl p-3 border border-gray-600 focus:border-blue-500 focus:outline-none"
                                        placeholder="45"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-300 mb-2">
                                        Distance (miles) - Optional
                                    </label>
                                    <input
                                        type="number"
                                        step="0.1"
                                        value={distance}
                                        onChange={(e) => setDistance(e.target.value)}
                                        className="w-full bg-gray-700 text-white rounded-xl p-3 border border-gray-600 focus:border-blue-500 focus:outline-none"
                                        placeholder="5.2"
                                    />
                                </div>

                                <div>
<label className="block text-sm font-medium text-gray-300 mb-2">
                                        Avg Pace (min/mile) - Optional
                                    </label>
                                    <input
                                        type="text"
                                        value={pace}
                                        onChange={(e) => setPace(e.target.value)}
                                        className="w-full bg-gray-700 text-white rounded-xl p-3 border border-gray-600 focus:border-blue-500 focus:outline-none"
                                        placeholder="8:30"
                                    />
                                </div>
                            </div>
                        )}

                        <div className="mt-6 bg-gray-800 rounded-xl p-4">
                            <label className="block text-sm font-medium text-gray-300 mb-3">
                                How Did It Feel?
                            </label>
                            <div className="flex justify-center gap-2">
                                {[1, 2, 3, 4, 5].map((star) => (
                                    <button
                                        key={star}
                                        onClick={() => setFeeling(star)}
                                        className="transition"
                                    >
                                        <Star
                                            size={36}
                                            className={feeling >= star ? 'text-yellow-400' : 'text-gray-600'}
                                            filled={feeling >= star}
                                        />
                                    </button>
                                ))}
                            </div>
                            <div className="flex justify-between text-xs text-gray-500 mt-2">
                                <span>Terrible</span>
                                <span>Amazing</span>
                            </div>
                        </div>

                        <div className="mt-6">
                            <label className="block text-sm font-medium text-gray-300 mb-2">
                                Notes (Optional)
                            </label>
                            <textarea
                                value={notes}
                                onChange={(e) => setNotes(e.target.value)}
                                className="w-full bg-gray-800 text-white rounded-xl p-3 border border-gray-700 focus:border-blue-500 focus:outline-none"
                                rows="3"
                                placeholder="How did the workout go? Any PRs or modifications?"
                            />
                        </div>

                        <button
                            onClick={handleSave}
                            disabled={isCardio ? !duration : exerciseLog.length === 0}
                            className="w-full mt-6 bg-green-600 hover:bg-green-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-bold py-4 rounded-xl transition"
                        >
                            Complete Workout
                        </button>

                        <div className="mt-4 bg-blue-900/30 border border-blue-500/50 rounded-xl p-4">
                            <p className="text-blue-200 text-sm font-medium mb-2">🍎 Apple Health Sync</p>
                            <p className="text-gray-400 text-xs mb-3">
                                Auto-sync coming soon! For now, manually log your workouts.
                            </p>
                            <button
                                disabled
                                className="w-full bg-gray-700 text-gray-500 font-semibold py-2 rounded-lg cursor-not-allowed"
                            >
                                Sync from Apple Health (Coming Soon)
                            </button>
                        </div>
                    </div>
                );
            };

            const BottomNav = () => {
                const navItems = [
                    { id: 'dashboard', icon: Dumbbell, label: 'Home' },
                    { id: 'planner', icon: Calendar, label: 'Plan' },
                    { id: 'logger', icon: Plus, label: 'Log' },
                    { id: 'profile', icon: User, label: 'Profile' }
                ];

                return (
                    <div className="fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800">
                        <div className="flex justify-around items-center h-20 max-w-md mx-auto">
                            {navItems.map(item => {
                                const Icon = item.icon;
                                const isActive = currentView === item.id;
                                return (
                                    <button
                                        key={item.id}
                                        onClick={() => {
                                            if (item.id === 'logger') {
                                                setLogMode('manual');
                                                setScheduledWorkoutToLog(null);
                                            }
                                            setCurrentView(item.id);
                                        }}
                                        className="flex flex-col items-center justify-center flex-1 h-full"
                                    >
                                        <Icon 
                                            size={24} 
                                            className={isActive ? 'text-blue-500' : 'text-gray-500'}
                                        />
                                        <span className={`text-xs mt-1 ${isActive ? 'text-blue-500' : 'text-gray-500'}`}>
                                            {item.label}
                                        </span>
                                    </button>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-900 pb-20">
                    {currentView === 'dashboard' && <Dashboard />}
                    {currentView === 'profile' && <ProfileSetup />}
                    {currentView === 'planner' && <WeeklyPlanner />}
                    {currentView === 'logger' && <WorkoutLogger />}
                    
                    <BottomNav />
                    
                    {videoModal && (
                        <ExerciseVideoModal
                            exercise={videoModal}
                            onClose={() => setVideoModal(null)}
                        />
                    )}
                </div>
            );
        };

        ReactDOM.render(<GetItDone />, document.getElementById('root'));
    </script>
</body>
</html>
